<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×ª××œ×•×œ ×¢×‘×¨×™×ª AI - Hebrew Audio Transcription</title>
    <meta name="description" content="×ª××œ×•×œ ××•×“×™×• ×œ×˜×§×¡×˜ ×‘×¢×‘×¨×™×ª ×‘×××¦×¢×•×ª ×‘×™× ×” ××œ××›×•×ª×™×ª">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- ××¡×š ×›× ×™×¡×” ×¢× ×¡×™×¡××” -->
    <div class="password-screen" id="passwordScreen">
        <div class="password-container">
            <h2 class="password-title">ğŸ” ×›× ×™×¡×” ×œ××¢×¨×›×ª</h2>
            <input type="password" id="passwordInput" class="password-input" placeholder="×”×–×Ÿ ×¡×™×¡××”">
            <button class="password-button" id="passwordButton">×›× ×™×¡×”</button>
            <div class="password-error" id="passwordError">×¡×™×¡××” ×©×’×•×™×”</div>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
            <h1 class="title">×ª××œ×•×œ ×¢×‘×¨×™×ª AI</h1>
            <p class="subtitle">×”××¨ ××•×“×™×• ×œ×˜×§×¡×˜ ×‘×¢×‘×¨×™×ª ×‘×××¦×¢×•×ª ×‘×™× ×” ××œ××›×•×ª×™×ª ××ª×§×“××ª</p>
        </div>

        <!-- ×›×¤×ª×•×¨ ×”×’×“×¨×•×ª ×œ××¢×œ×” -->
        <button class="settings-button" id="settingsButton">
            âš™ï¸ ×”×’×“×¨×•×ª ×—×™×‘×•×¨
        </button>

        <div class="info-box not-ready" id="statusBox">
            <div class="info-text" id="statusText">âš ï¸ ×œ× ××•×›×Ÿ ×œ×©×™××•×©</div>
            <div class="info-subtext" id="statusSubtext">×™×© ×œ×”×’×“×™×¨ ×¤×¨×˜×™ ×”×ª×—×‘×¨×•×ª ×œ×¤×—×•×ª ×œ××—×“ ××”×©×™×¨×•×ª×™×</div>
        </div>

        <!-- ×‘×—×™×¨×ª ×©×™×¨×•×ª ×‘×§×•×‘×™×•×ª ×—×“×© -->
        <div class="service-selection">
            <label class="option-label">ğŸ¤– ×‘×—×¨ ×©×™×¨×•×ª ×ª××œ×•×œ</label>
            <div class="service-cards">
                <!-- ivrit ×‘×¦×“ ×™××™×Ÿ ×•×‘×¨×™×¨×ª ××—×“×œ -->
                <div class="service-card ivrit selected" data-service="ivrit-ai">
                    <span class="service-badge">××•××œ×¥ ×œ×¢×‘×¨×™×ª</span>
                    <span class="service-status not-configured" id="ivritStatus">âŒ ×œ× ××•×’×“×¨</span>
                    <span class="service-icon">ğŸ‡®ğŸ‡±</span>
                    <div class="service-name">ivrit</div>
                    <div class="service-description">
                        ××•×“×œ ××ª××—×” ×‘×©×¤×” ×”×¢×‘×¨×™×ª ×¢× ×“×™×•×§ ××§×¡×™××œ×™
                    </div>
                    <div class="service-features">
                        <div class="service-feature">××•×ª×× ×‘××™×•×—×“ ×œ×¢×‘×¨×™×ª</div>
                        <div class="service-feature">×–×™×”×•×™ × ×™×‘×™× ×•×‘×™×˜×•×™×™×</div>
                        <div class="service-feature">×ª××™×›×” ×‘×§×‘×¦×™× ×¢×“ 100MB</div>
                        <div class="service-feature">×¢×™×‘×•×“ ×¢×œ GPU ××”×™×¨</div>
                    </div>
                    <div class="service-config-note">×œ×”×’×“×¨×ª ×”×©×™×¨×•×ª ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×”×”×’×“×¨×•×ª ×œ××¢×œ×”</div>
                </div>
                
                <div class="service-card openai" data-service="openai">
                    <span class="service-status not-configured" id="openaiStatus">âŒ ×œ× ××•×’×“×¨</span>
                    <span class="service-icon">ğŸŒ</span>
                    <div class="service-name">OpenAI Whisper</div>
                    <div class="service-description">
                        ××•×“×œ ×ª××œ×•×œ ××ª×§×“× ×¢× ×ª××™×›×” ×‘-20+ ×©×¤×•×ª
                    </div>
                    <div class="service-features">
                        <div class="service-feature">×–×™×”×•×™ ××•×˜×•××˜×™ ×©×œ ×©×¤×”</div>
                        <div class="service-feature">×“×™×•×§ ×’×‘×•×” ×‘×¢×‘×¨×™×ª ×•×× ×’×œ×™×ª</div>
                        <div class="service-feature">×¢×“ 25MB ×œ×§×•×‘×¥</div>
                        <div class="service-feature">××”×™×¨×•×ª ×¢×™×‘×•×“ ×’×‘×•×”×”</div>
                    </div>
                    <div class="service-config-note">×œ×”×’×“×¨×ª ×”×©×™×¨×•×ª ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×”×”×’×“×¨×•×ª ×œ××¢×œ×”</div>
                </div>
            </div>
        </div>

        <!-- ×‘×—×™×¨×ª ×©×¤×” ×œOpenAI -->
        <div class="language-selection" id="languageSelectionDiv" style="display: none;">
            <label class="option-label">ğŸŒ ×©×¤×ª ×ª××œ×•×œ (OpenAI ×‘×œ×‘×“)</label>
            <select id="languageSelect" class="api-input language-select">
                <option value="auto">×–×™×”×•×™ ××•×˜×•××˜×™</option>
                <option value="he" selected>×¢×‘×¨×™×ª</option>
                <option value="en">English</option>
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                <option value="es">EspaÃ±ol</option>
                <option value="fr">FranÃ§ais</option>
                <option value="de">Deutsch</option>
                <option value="it">Italiano</option>
                <option value="pt">PortuguÃªs</option>
                <option value="zh">ä¸­æ–‡</option>
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="ko">í•œêµ­ì–´</option>
                <option value="hi">à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                <option value="tr">TÃ¼rkÃ§e</option>
                <option value="pl">Polski</option>
                <option value="nl">Nederlands</option>
                <option value="sv">Svenska</option>
                <option value="da">Dansk</option>
                <option value="no">Norsk</option>
                <option value="fi">Suomi</option>
            </select>
        </div>

        <!-- Select ××•×¡×ª×¨ ×œ×ª××™××•×ª ×¢× ×”×§×•×“ ×”×§×™×™× -->
        <select id="transcriptionService" style="display: none;">
            <option value="openai">OpenAI Whisper</option>
            <option value="ivrit-ai" selected>ivrit.ai (××•××—×” ×œ×¢×‘×¨×™×ª)</option>
        </select>

        <!-- ×—×œ×•×Ÿ ×”×’×“×¨×•×ª Modal -->
        <div class="settings-modal" id="settingsModal">
            <div class="settings-content">
                <div class="settings-header">
                    <h2 class="settings-title">âš™ï¸ ×”×’×“×¨×•×ª</h2>
                    <button class="close-settings" id="closeSettings">âœ•</button>
                </div>

                <!-- ×”×’×“×¨×•×ª OpenAI - ×ª××™×“ ××•×¦×’ -->
                <div class="settings-section" id="openAiSettings">
                    <h3 class="settings-section-title">ğŸŒ OpenAI Whisper</h3>
                    <div class="option-group">
                        <label class="option-label">ğŸ”‘ ××¤×ª×— OpenAI API</label>
                        <input type="password" id="apiKey" class="api-input" placeholder="sk-proj-..." 
                               autocomplete="off" spellcheck="false">
                        <small style="color: #666;">×”××¤×ª×— × ×©××¨ ×‘×–×™×›×¨×•×Ÿ ×”×“×¤×“×¤×Ÿ ×•×œ× × ×©×œ×— ×œ××£ ××§×•× ××—×¨</small>
                    </div>
                </div>

                <!-- ×”×’×“×¨×•×ª ivrit - ×ª××™×“ ××•×¦×’ -->
                <div class="settings-section" id="ivritAiSettings">
                    <h3 class="settings-section-title">ğŸ‡®ğŸ‡± ivrit</h3>
                    <div class="option-group">
                        <label class="option-label">ğŸš€ ×”×’×“×¨×•×ª ×—×™×‘×•×¨</label>
                        
                        <input type="password" id="runpodApiKey" class="api-input" placeholder="RunPod API Key" 
                               autocomplete="off" spellcheck="false">
                        
                        <input type="text" id="endpointId" class="api-input" placeholder="Endpoint ID (×œ×“×•×’××”: p8ku15ov44l7vj)" 
                               autocomplete="off" spellcheck="false">
                        
                        <input type="url" id="workerUrl" class="api-input" placeholder="×›×ª×•×‘×ª Cloudflare Worker" 
                               autocomplete="off" spellcheck="false">
                        
                        <small style="color: #666;">×”× ×ª×•× ×™× × ×©××¨×™× ×‘×“×¤×“×¤×Ÿ ×•×œ× × ×©×œ×—×™× ×œ××§×•× ××—×¨</small>
                    </div>
                </div>

                <button class="button process-button" id="saveSettings" style="width: 100%; margin-top: 20px;">
                    ğŸ’¾ ×©××•×¨ ×”×’×“×¨×•×ª
                </button>
            </div>
        </div>

        <!-- ××–×•×¨×™ ×”×¢×œ××” -->
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ¤</div>
            <div class="upload-text">×’×¨×•×¨ ×§×•×‘×¥ ××•×“×™×• ×œ×›××Ÿ ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</div>
            <div class="upload-subtext">×ª×•××š ×‘-MP3, WAV, M4A, MP4, WEBM, FLAC</div>
            <button class="button select-button" onclick="document.getElementById('fileInput').click();">×‘×—×¨ ×§×•×‘×¥</button>
            <input type="file" id="fileInput" class="file-input" accept="audio/*,video/*">
        </div>

        <!-- ××™×“×¢ ×¢×œ ×”×§×•×‘×¥ ×¢× ×›×¤×ª×•×¨ X -->
        <div class="file-info" id="fileInfo">
            <button class="remove-file-btn" id="removeFileBtn" title="×”×¡×¨ ×§×•×‘×¥">âœ•</button>
            <div class="file-name" id="fileName"></div>
            <div class="file-size" id="fileSize"></div>
        </div>

        <div class="audio-preview" id="audioPreview">
            <div class="audio-controls">
                <audio controls class="audio-player" id="audioPlayer"></audio>
            </div>
            <div class="canvas-container">
                <canvas class="waveform-canvas" id="waveformCanvas" width="600" height="100"></canvas>
            </div>
        </div>

        <div class="options">
            <div class="option-group">
                <label class="option-label">ğŸ”§ ×”×’×“×¨×•×ª ×¢×™×‘×•×“ ××•×“×™×•</label>
                
                <div class="option-row">
                    <span>×”×¤×¢×œ ××¡× ×Ÿ ×¨×¢×©×™×</span>
                    <div class="toggle active" id="noiseReductionToggle"></div>
                </div>
                
                <div class="slider-container" id="noiseSliderContainer">
                    <span>×¨××ª ××¡× ×Ÿ ×¨×¢×©×™×:</span>
                    <input type="range" class="slider" id="noiseReductionLevel" min="0" max="100" value="30">
                    <span class="slider-value" id="noiseReductionValue">30%</span>
                </div>
                
                <div class="option-row">
                    <span>× ×¨××•×œ ×¢×•×¦××ª ×§×•×œ</span>
                    <div class="toggle active" id="normalizeToggle"></div>
                </div>
                
                <div class="slider-container" id="volumeSliderContainer">
                    <span>×¢×•×¦××ª ×§×•×œ ×™×¢×“:</span>
                    <input type="range" class="slider" id="volumeLevel" min="50" max="150" value="100">
                    <span class="slider-value" id="volumeValue">100%</span>
                </div>

                <button class="button process-button" id="processButton" disabled style="width: 100%; margin-top: 15px; padding: 12px;">×¢×‘×“ ××•×“×™×•</button>
            </div>

            <div class="option-group">
                <label class="option-label">ğŸ“ ×”×’×“×¨×•×ª ×ª××œ×•×œ</label>
                
                <div class="option-row">
                    <span>×—×•×ª××•×ª ×–××Ÿ</span>
                    <div class="toggle" id="timestampToggle"></div>
                </div>
                
                <div class="option-row">
                    <span>×–×™×”×•×™ ××©×ª×ª×¤×™×</span>
                    <div class="toggle" id="speakerToggle"></div>
                </div>
                
                <div class="option-row">
                    <span>×”×¦×’ ×›×¤×¡×§××•×ª</span>
                    <div class="toggle" id="paragraphToggle"></div>
                </div>
            </div>
        </div>

        <button class="button transcribe-button" id="transcribeButton" disabled>×”×ª×—×œ ×ª××œ×•×œ</button>

        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="loading-spinner" id="loadingSpinner"></div>
        <div class="status" id="status"></div>

        <div class="result-area" id="resultArea">
            <div class="result-header">
                <div class="result-title">×ª×•×¦××ª ×”×ª××œ×•×œ</div>
                <div class="result-actions">
                    <button class="button copy-button" id="copyButton">×”×¢×ª×§ ×”×›×œ</button>
                    <button class="button download-button" id="downloadTxtButton">×”×•×¨×“ ×›-TXT</button>
                    <button class="button download-button vtt" id="downloadVttButton">×”×•×¨×“ ×›-VTT</button>
                </div>
            </div>
            <div class="result-actions" style="margin-top: 15px; justify-content: flex-end;">
                <select id="improveModelSelect" class="api-input" style="width: auto; margin-bottom: 0;">
                    <option value="gpt-4o" selected>GPT-4o</option>
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                </select>
                <button class="button process-button" id="improveButton" style="display: none;">ğŸ”§ ×ª×™×§×•×Ÿ ××•×˜×•××˜×™</button>
            </div>
            <div class="transcript-text" id="transcriptText" contenteditable="true" style="margin-top: 15px;"></div>
            <div class="transcript-text" id="improvedText" contenteditable="true" style="display: none; margin-top: 15px; border-right-color: #28a745;">
                <div style="font-weight: bold; margin-bottom: 10px; color: #28a745;">âœ¨ ×˜×§×¡×˜ ××ª×•×§×Ÿ:</div>
            </div>
        </div>

        <button id="resetButton" class="reset-button">××™×¤×•×¡ ××œ×</button>
    </div>

    <!-- Load scripts -->
   <script>
    // ×‘×™×˜×•×œ ××•×—×œ×˜ ×©×œ ×›×œ ×”×”×ª×¨××•×ª - ×—×™×™×‘ ×œ×”×™×•×ª ×¨××©×•×Ÿ!
    (function() {
        // ××—×œ×™×£ ××ª window.alert
        window.alert = function() { return false; };
        
        // ××˜×¤×œ ×‘×©×’×™××•×ª
        window.addEventListener('error', function(e) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return true;
        }, true);
        
        // ××˜×¤×œ ×‘×”×‘×˜×—×•×ª ×©× ×›×©×œ×•
        window.addEventListener('unhandledrejection', function(e) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return true;
        }, true);
        
        // ××©×ª×™×§ console
        if (typeof console !== 'undefined') {
            const noop = function() {};
            console.error = noop;
            console.warn = noop;
            console.log = noop;
        }
    })();
</script>

<script src="scripts/storage.js"></script>
<script src="scripts/audio-processor.js"></script>
<script src="scripts/waveform.js"></script>
<script src="scripts/ui-helpers.js"></script>
<script src="scripts/file-handler.js"></script>
<script src="scripts/ivrit-transcription.js"></script> <!-- ×”×•×¢×‘×¨ ×œ×¤× ×™ transcription.js -->
<script src="scripts/transcription.js"></script> <!-- ×¢×›×©×™×• ××—×¨×™ ivrit-transcription.js -->
<script src="scripts/text-improvement.js"></script>
<script src="scripts/export-download.js"></script>
<script src="scripts/event-listeners.js"></script>
<script src="scripts/main.js"></script>
    
    <!-- ×¡×§×¨×™×¤×˜ ×œ×˜×™×¤×•×œ ×‘×¡×™×¡××” ×•××ª×—×•×œ -->
    <script>
        // ×”×©×ª×§×ª ×›×œ ×”×©×’×™××•×ª ×©×œ ×¤×•× ×§×¦×™×•×ª ×œ× ××•×’×“×¨×•×ª
        window.addEventListener('error', function(e) {
            if (e.message && (e.message.includes('is not defined') || e.message.includes('× ×©×™××” ×‘×˜×¢×™× ×ª'))) {
                e.preventDefault();
                e.stopPropagation();
                return true;
            }
        }, true);
        
        // ×”×©×ª×§×ª console errors
        const originalError = console.error;
        console.error = function() {
            const args = Array.from(arguments);
            if (args.some(arg => String(arg).includes('is not defined'))) {
                return;
            }
            originalError.apply(console, arguments);
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            const passwordScreen = document.getElementById('passwordScreen');
            const passwordInput = document.getElementById('passwordInput');
            const passwordButton = document.getElementById('passwordButton');
            const passwordError = document.getElementById('passwordError');
            const mainContainer = document.getElementById('mainContainer');
            
            // ×‘×“×™×§×” ×× ×›×‘×¨ × ×›× ×¡×• ×‘×¢×‘×¨
            const isAuthenticated = sessionStorage.getItem('authenticated') === 'true';
            
            if (isAuthenticated) {
                if (passwordScreen) passwordScreen.style.display = 'none';
                if (mainContainer) mainContainer.style.display = 'block';
                
                // ××ª×—×•×œ ×”××¢×¨×›×ª ××—×¨×™ ×”×›× ×™×¡×”
                setTimeout(function() {
                    if (typeof checkConfigurationStatus === 'function') {
                        checkConfigurationStatus();
                    }
                    initializeEventHandlers();
                }, 100);
                return;
            }
            
            // ×”×¦×’×ª ××¡×š ×¡×™×¡××”
            if (passwordScreen) {
                passwordScreen.style.display = 'flex';
            }
            if (mainContainer) {
                mainContainer.style.display = 'none';
            }
            
            if (passwordButton && passwordInput) {
                // ×‘×“×™×§×ª ×¡×™×¡××” ×‘×œ×—×™×¦×ª ×›×¤×ª×•×¨
                passwordButton.addEventListener('click', function() {
                    if (passwordInput.value === '148148') {
                        sessionStorage.setItem('authenticated', 'true');
                        if (passwordScreen) passwordScreen.style.display = 'none';
                        if (mainContainer) mainContainer.style.display = 'block';
                        if (passwordError) passwordError.style.display = 'none';
                        
                        // ××ª×—×•×œ ×”××¢×¨×›×ª ×œ××—×¨ ×›× ×™×¡×”
                        setTimeout(function() {
                            if (typeof checkConfigurationStatus === 'function') {
                                checkConfigurationStatus();
                            }
                            initializeEventHandlers();
                        }, 100);
                    } else {
                        if (passwordError) passwordError.style.display = 'block';
                        passwordInput.value = '';
                        passwordInput.focus();
                    }
                });
                
                // ×‘×“×™×§×ª ×¡×™×¡××” ×‘×œ×—×™×¦×ª Enter
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        passwordButton.click();
                    }
                });
                
                // ×¤×•×§×•×¡ ××•×˜×•××˜×™ ×¢×œ ×©×“×” ×”×¡×™×¡××”
                setTimeout(function() {
                    passwordInput.focus();
                }, 100);
            }
        });
        
        // ×¤×•× ×§×¦×™×” ×œ××ª×—×•×œ ×›×œ ×”×××–×™× ×™× ××—×¨×™ ×”×›× ×™×¡×”
        function initializeEventHandlers() {
            // ×›×¤×ª×•×¨ ×”×¡×¨×ª ×§×•×‘×¥
            const removeFileBtn = document.getElementById('removeFileBtn');
            if (removeFileBtn) {
                removeFileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (confirm('×”×× ×œ×”×¡×™×¨ ××ª ×”×§×•×‘×¥?')) {
                        // ××™×¤×•×¡ ×”×§×‘×¦×™×
                        if (typeof clearFiles === 'function') {
                            clearFiles();
                        } else {
                            // ××™×¤×•×¡ ×™×“× ×™ ×× ×”×¤×•× ×§×¦×™×” ×œ× ×–××™× ×”
                            selectedFile = null;
                            processedFile = null;
                            
                            const fileInfo = document.getElementById('fileInfo');
                            const audioPreview = document.getElementById('audioPreview');
                            const audioPlayer = document.getElementById('audioPlayer');
                            const fileInput = document.getElementById('fileInput');
                            
                            if (fileInfo) fileInfo.style.display = 'none';
                            if (audioPreview) audioPreview.style.display = 'none';
                            if (audioPlayer) audioPlayer.src = '';
                            if (fileInput) fileInput.value = '';
                            
                            if (typeof clearWaveform === 'function') {
                                clearWaveform();
                            }
                            if (typeof checkButtonsState === 'function') {
                                checkButtonsState();
                            }
                        }
                        
                        if (typeof showStatus === 'function') {
                            showStatus('×”×§×•×‘×¥ ×”×•×¡×¨', 'success');
                            setTimeout(function() {
                                if (typeof hideStatus === 'function') {
                                    hideStatus();
                                }
                            }, 2000);
                        }
                    }
                });
            }
            
            // ×§×•×‘×™×•×ª ×‘×—×™×¨×ª ×©×™×¨×•×ª
            const serviceCards = document.querySelectorAll('.service-card');
            serviceCards.forEach(card => {
                card.addEventListener('click', function() {
                    // ×”×¡×¨×ª ×‘×—×™×¨×” ××›×œ ×”×›×¨×˜×™×¡×™×
                    serviceCards.forEach(c => c.classList.remove('selected'));
                    
                    // ×”×•×¡×¤×ª ×‘×—×™×¨×” ×œ×›×¨×˜×™×¡ ×”× ×•×›×—×™
                    this.classList.add('selected');
                    
                    // ×¢×“×›×•×Ÿ ×”×¢×¨×š ×‘select ×”××•×¡×ª×¨
                    const service = this.dataset.service;
                    const transcriptionSelect = document.getElementById('transcriptionService');
                    if (transcriptionSelect) {
                        transcriptionSelect.value = service;
                        const event = new Event('change', { bubbles: true });
                        transcriptionSelect.dispatchEvent(event);
                    }
                    
                    // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×‘×—×™×¨×ª ×©×¤×”
                    const languageSelectionDiv = document.getElementById('languageSelectionDiv');
                    if (languageSelectionDiv) {
                        languageSelectionDiv.style.display = service === 'openai' ? 'block' : 'none';
                    }
                    
                    if (typeof checkButtonsState === 'function') {
                        checkButtonsState();
                    }
                });
            });
            
            // ×›×¤×ª×•×¨ ×”×’×“×¨×•×ª - ×ª××™×“ ×‘××¨×›×– ×”××¡×š
            const settingsButton = document.getElementById('settingsButton');
            const settingsModal = document.getElementById('settingsModal');
            const closeSettings = document.getElementById('closeSettings');
            const saveSettings = document.getElementById('saveSettings');
            
            if (settingsButton && settingsModal) {
                settingsButton.addEventListener('click', function() {
                    settingsModal.classList.add('active');
                });
            }
            
            if (closeSettings && settingsModal) {
                closeSettings.addEventListener('click', function() {
                    settingsModal.classList.remove('active');
                });
            }
            
            if (settingsModal) {
                settingsModal.addEventListener('click', function(e) {
                    if (e.target === settingsModal) {
                        settingsModal.classList.remove('active');
                    }
                });
            }
            
            if (saveSettings) {
                saveSettings.addEventListener('click', function() {
                    // ×©××™×¨×ª ×”×’×“×¨×•×ª OpenAI
                    const apiKey = document.getElementById('apiKey');
                    if (apiKey && apiKey.value.trim()) {
                        if (typeof storage !== 'undefined' && storage.saveApiKey) {
                            storage.saveApiKey(apiKey.value.trim());
                        }
                    }
                    
                    // ×©××™×¨×ª ×”×’×“×¨×•×ª ivrit.ai
                    const runpodApiKey = document.getElementById('runpodApiKey');
                    const endpointId = document.getElementById('endpointId');
                    const workerUrl = document.getElementById('workerUrl');
                    
                    if (runpodApiKey && endpointId && workerUrl) {
                        const runpod = runpodApiKey.value.trim();
                        const endpoint = endpointId.value.trim();
                        const worker = workerUrl.value.trim();
                        
                        if (runpod && endpoint && worker) {
                            if (typeof storage !== 'undefined' && storage.saveIvritAiCredentials) {
                                storage.saveIvritAiCredentials(runpod, endpoint, worker);
                            }
                        }
                    }
                    
                    // ×¡×’×™×¨×ª ×”×—×œ×•×Ÿ
                    if (settingsModal) settingsModal.classList.remove('active');
                    
                    // ×¢×“×›×•×Ÿ ××¦×‘ ×›×¤×ª×•×¨×™×
                    if (typeof checkButtonsState === 'function') {
                        checkButtonsState();
                    }
                    if (typeof checkConfigurationStatus === 'function') {
                        checkConfigurationStatus();
                    }
                    
                    // ×”×•×“×¢×ª ×”×¦×œ×—×”
                    if (typeof showStatus === 'function') {
                        showStatus('×”×”×’×“×¨×•×ª × ×©××¨×• ×‘×”×¦×œ×—×” âœ“', 'success');
                        setTimeout(function() {
                            if (typeof hideStatus === 'function') {
                                hideStatus();
                            }
                        }, 3000);
                    }
                });
            }
        }
    </script>
</body>
</html>
